{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <link
            href="https://fonts.googleapis.com/css?family=Montserrat|Roboto&display=swap"
            rel="stylesheet"
    />
    <script src="https://kit.fontawesome.com/2e0586df66.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">
    <title>Bookstore</title>
</head>
<body>

<!-- Top Nav -->
<header
        x-data="
        {
          navbarOpen: false
        }
      "
        class="flex w-full items-center bg-white dark:bg-dark bg-gray-200 h-16 mb-8"
>
    <div class="container mx-auto">
        <div class="relative -mx-4 flex items-center justify-between">
            <div class="flex w-full items-center justify-between px-4">
                <ul class="block lg:flex">
                    <li>
                        <a
                                href="/books"
                                class="flex py-2 text-base font-medium text-body-color hover:text-dark dark:text-dark-6 dark:hover:text-white lg:ml-12 lg:inline-flex"
                        >
                            Home
                        </a>
                    </li>
                </ul>
            </div>
            <div class="hidden justify-end pr-16 sm:flex lg:pr-0 text-center flex items-center">
                <form method="POST" action="{% url 'search:search_books' %}"
                      class="flex justify-center items-center">
                    {% csrf_token %}
                    <input
                            name="search_input"
                            type="text"
                            placeholder="Search"
                            class="w-[60px] h-10 border-slate-600 rounded-md border border-stroke px-5 py-3 text-base text-body-color outline-none focus:border-primary focus-visible:shadow-none dark:border-dark-3 dark:text-white"
                    />
                    <button type="submit"
                            class="ml-3 h-10 text-white bg-blue-700 hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 font-medium rounded-full text-sm px-5 py-2.5 text-center me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
                        Search
                    </button>
                </form>
                <form method="POST" action="{% url 'search:search_books_by_voice' %}"
                      class="flex justify-center items-center">
                    {% csrf_token %}
                    <button id="microphoneButton" type="submit" class="ml-10 cursor-pointer">
                        <i class='fas fa-microphone cursor-pointer'
                           style='font-size:24px'></i>
                    </button>
                </form>
{#                <form method="post" enctype="multipart/form-data" action="{% url 'search:search_books_by_image' %}">#}
{#                    {% csrf_token %}#}
{#                    <input type="file" name="image">#}
{#                    <button type="submit">Upload Image</button>#}
{#                </form>#}
                <span class="ml-10"><i class='fas fa-cart-plus' style='font-size:24px'></i></span>
            </div>
        </div>
    </div>
</header>

<main>
    <section class="bg-gray-2 pb-10 pt-20 dark:bg-dark lg:pb-20 lg:pt-[40px]">
        <div class="container mx-auto">
            <div class="-mx-2 flex flex-wrap">
                {% for book in books %}
                    <div class="w-full md:w-1/2 xl:w-1/3 border-2 p-8 mr-4 mb-4">
                        <div class="overflow-hidden rounded bg-white shadow-1 duration-300 hover:shadow-3 dark:bg-dark-2 dark:shadow-card dark:hover:shadow-3">
                            <div class="flex justify-center items-center">
                                <img style="width: 160px"
                                     alt=""
                                     src=
                                             {% if book.image %}
                                                 {% static 'images/' %}{{ book.image }}
                                             {% else %}
                                                 {% static 'images/default_cover.jpg' %}
                                             {% endif %}
                                />
                            </div>
                            <div class="p-8 text-center sm:p-9 md:p-7 xl:p-9">
                                <h3>
                                    <a href="javascript:void(0)"
                                       class="mb-4 block text-xl font-semibold text-dark hover:text-primary dark:text-white sm:text-[22px] md:text-xl lg:text-[22px] xl:text-xl 2xl:text-[22px]"
                                    >
                                        {{ book.title }}
                                    </a>
                                </h3>
                                <p class="mb-7 text-base leading-relaxed text-body-color dark:text-dark-6">
                                    {% if book.old_price %}
                                        <span class="line-through font-extralight">${{ book.old_price }}</span>
                                        <span class="font-bold">${{ book.price }}</span>
                                    {% else %}
                                        <span class="font-bold">${{ book.price }}</span>
                                    {% endif %}
                                </p>

                                <div class="mt-4">
                                    <button
                                            href="javascript:void(0)"
                                            class="inline-block rounded-full border border-gray-3 px-4 py-2 text-base font-medium text-body-color transition hover:border-primary hover:bg-primary dark:border-dark-3 dark:text-dark-6"
                                    >
                                        View Details
                                    </button>
                                    <button
                                            href="javascript:void(0)"
                                            class="inline-block rounded-full border border-gray-3 px-4 py-2 text-base font-medium text-body-color transition hover:border-primary hover:bg-primary dark:border-dark-3 dark:text-dark-6"
                                            id="add-button"
                                            value="{{ book.id }}"
                                    >
                                        Add to cart
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </section>
</main>
</body>

{#<script>#}
{#    document.getElementById("microphoneButton").addEventListener("click", function () {#}
{#        let recognition = new webkitSpeechRecognition();#}
{#        recognition.continuous = false;#}
{#        recognition.lang = 'vi-VN';#}
{##}
{#        recognition.onresult = function (event) {#}
{#            let audioData = event.results[0][0].transcript;#}
{#            sendAudioToSpeechToText(audioData);#}
{#        };#}
{##}
{#        recognition.onerror = function (event) {#}
{#            console.error('Lỗi nhận dạng giọng nói:', event.error);#}
{#        };#}
{##}
{#        recognition.start();#}
{#    });#}
{##}
{#    function sendAudioToSpeechToText(audioData) {#}
{#        $(document).ready(function () {#}
{#            $.ajax({#}
{#                url: '/search_books_by_voice/',#}
{#                type: 'POST',#}
{#                data: {#}
{#                    text: audioData#}
{#                },#}
{#                headers: {'X-CSRFToken': getCookie('csrftoken')},#}
{#                success: function (response) {#}
{#                    window.location.href = response.route;#}
{#                    $(document).html(response.template);#}
{#                },#}
{#                error: function (xhr, errmsg, err) {#}
{#                    console.log('Error:', errmsg);#}
{#                }#}
{#            });#}
{#        });#}
{#    }#}
{##}
{#    function getCookie(name) {#}
{#        let cookieValue = null;#}
{#        if (document.cookie && document.cookie !== '') {#}
{#            const cookies = document.cookie.split(';');#}
{#            for (let i = 0; i < cookies.length; i++) {#}
{#                const cookie = cookies[i].trim();#}
{#                if (cookie.substring(0, name.length + 1) === (name + '=')) {#}
{#                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));#}
{#                    break;#}
{#                }#}
{#            }#}
{#        }#}
{#        return cookieValue;#}
{#    }#}
{#</script>#}
</html>